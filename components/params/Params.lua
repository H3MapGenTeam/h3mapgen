local DetailedParams = require'DetailedParams'
local LMLInitializer = require'LMLInitializer'

local Params = {}


--- Overrides generated detailedDarams with the ones given by the user. The 'seed' key is never overridden.
-- @param detailedParams Parameters generated by our system, modified by the function.
-- @param paramsDetailedUser User given values with higher priority (except 'seed').
local function overrideDetailedParams(detailedParams, paramsDetailedUser)
  for k, v in pairs(paramsDetailedUser) do
    if k ~= 'seed' then
      detailedParams[k] = paramsDetailedUser[k]
    end
  end
end


--- Function generates 'detailedParams' based on user's wishes about the generated map (also overrides generated values with the ones in 'paramsDetailedUser' if necessary)
-- @param state H3pgm state containing 'userMapParams', 'config' and optionally 'paramsDetailedUser' keys, which is extended by 'detailedParams'
function Params.GenerateDetailedParams(state)
  if not state.paramsGeneral then
    error('[ERROR] <Params> : Given h3pgm state do not contain paramsGeneral (required by Params.GenerateDetailedParams).', 2)
  end
  DetailedParams.Generate(state)
  if state.paramsDetailedUser then
    overrideDetailedParams(state.paramsDetailed, state.paramsDetailedUser)
  end
end


--- Function generates 'LML_InitNode' field containing initial node for LML stage
-- @param state H3pgm state after GenerateDetailedParams function applied
function Params.GenerateInitLMLNode(state)
  if not state.paramsDetailed then
    error('[ERROR] <Params> : Given h3pgm state do not contain paramsDetailed (required by Params.GenerateInitLMLNode).', 2)
  end
  LMLInitializer.Generate(state)
end


return Params
